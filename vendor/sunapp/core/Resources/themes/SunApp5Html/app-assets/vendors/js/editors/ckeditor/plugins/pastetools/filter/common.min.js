!function(){function e(e){var t,r,n=e.margin?"margin":!!e.MARGIN&&"MARGIN";if(n){for(t in r=CKEDITOR.tools.style.parse.margin(e[n]))e["margin-"+t]=r[t];delete e[n]}}var t,r=CKEDITOR.tools,n={};CKEDITOR.plugins.pastetools.filters.common=n,n.rules=function(e,n,o){return{elements:{table:function(e){e.filterChildren(o);var n,s,i=e.parent,l=i&&i.parent;if(i.name&&"div"===i.name&&i.attributes.align&&1===r.object.keys(i.attributes).length&&1===i.children.length){for(e.attributes.align=i.attributes.align,n=i.children.splice(0),e.remove(),s=n.length-1;0<=s;s--)l.add(n[s],i.getIndex());i.remove()}t.convertStyleToPx(e)},tr:function(e){e.attributes={}},td:function(e){var s=e.getAscendant("table");(l=(s=r.parseCssText(s.attributes.style,!0)).background)&&t.setStyle(e,"background",l,!0),(s=s["background-color"])&&t.setStyle(e,"background-color",s,!0);var i,l=(s=r.parseCssText(e.attributes.style,!0)).border?CKEDITOR.tools.style.border.fromCssRule(s.border):{},a=(l=r.style.border.splitCssValues(s,l),CKEDITOR.tools.clone(s));for(i in a)0==i.indexOf("border")&&delete a[i];for(var u in e.attributes.style=CKEDITOR.tools.writeCssText(a),s.background&&((i=CKEDITOR.tools.style.parse.background(s.background)).color&&(t.setStyle(e,"background-color",i.color,!0),t.setStyle(e,"background",""))),l)"none"===(i=s[u]?CKEDITOR.tools.style.border.fromCssRule(s[u]):l[u]).style?t.setStyle(e,u,"none"):t.setStyle(e,u,i.toString());t.mapCommonStyles(e),t.convertStyleToPx(e),t.createStyleStack(e,o,n,/margin|text\-align|padding|list\-style\-type|width|height|border|white\-space|vertical\-align|background/i)}}}},n.styles={setStyle:function(e,t,n,o){var s=r.parseCssText(e.attributes.style);o&&s[t]||(""===n?delete s[t]:s[t]=n,e.attributes.style=CKEDITOR.tools.writeCssText(s))},convertStyleToPx:function(e){var t=e.attributes.style;t&&(e.attributes.style=t.replace(/\d+(\.\d+)?pt/g,(function(e){return CKEDITOR.tools.convertToPx(e)+"px"})))},mapStyles:function(e,r){for(var n in r)e.attributes[n]&&("function"==typeof r[n]?r[n](e.attributes[n]):t.setStyle(e,r[n],e.attributes[n]),delete e.attributes[n])},mapCommonStyles:function(e){return t.mapStyles(e,{vAlign:function(r){t.setStyle(e,"vertical-align",r)},width:function(r){t.setStyle(e,"width",r+"px")},height:function(r){t.setStyle(e,"height",r+"px")}})},normalizedStyles:function(t,o){var s="background-color:transparent border-image:none color:windowtext direction:ltr mso- visibility:visible div:border:none".split(" "),i="font-family font font-size color background-color line-height text-decoration".split(" "),l=function(){for(var e=[],t=0;t<arguments.length;t++)arguments[t]&&e.push(arguments[t]);return-1!==r.indexOf(s,e.join(":"))},a=!0===CKEDITOR.plugins.pastetools.getConfigValue(o,"removeFontStyles"),u=r.parseCssText(t.attributes.style);"cke:li"==t.name&&(u["TEXT-INDENT"]&&u.MARGIN?(t.attributes["cke-indentation"]=n.lists.getElementIndentation(t),u.MARGIN=u.MARGIN.replace(/(([\w\.]+ ){3,3})[\d\.]+(\w+$)/,"$10$3")):delete u["TEXT-INDENT"],delete u["text-indent"]);for(var c=r.object.keys(u),d=0;d<c.length;d++){var f=c[d].toLowerCase(),g=u[c[d]],b=CKEDITOR.tools.indexOf;(a&&-1!==b(i,f.toLowerCase())||l(null,f,g)||l(null,f.replace(/\-.*$/,"-"))||l(null,f)||l(t.name,f,g)||l(t.name,f.replace(/\-.*$/,"-"))||l(t.name,f)||l(g))&&delete u[c[d]]}var m=CKEDITOR.plugins.pastetools.getConfigValue(o,"keepZeroMargins");return e(u),CKEDITOR.tools.array.forEach(["top","right","bottom","left"],(function(e){if((e="margin-"+e)in u){var t=CKEDITOR.tools.convertToPx(u[e]);t||m?u[e]=t?t+"px":0:delete u[e]}})),CKEDITOR.tools.writeCssText(u)},createStyleStack:function(e,n,o,s){var i=[];for(e.filterChildren(n),n=e.children.length-1;0<=n;n--)i.unshift(e.children[n]),e.children[n].remove();t.sortStyles(e),n=r.parseCssText(t.normalizedStyles(e,o)),o=e;var l,a="span"===e.name;for(l in n)if(!l.match(s||/margin((?!-)|-left|-top|-bottom|-right)|text-indent|text-align|width|border|padding/i))if(a)a=!1;else{var u=new CKEDITOR.htmlParser.element("span");u.attributes.style=l+":"+n[l],o.add(u),o=u,delete n[l]}for(CKEDITOR.tools.isEmpty(n)?delete e.attributes.style:e.attributes.style=CKEDITOR.tools.writeCssText(n),n=0;n<i.length;n++)o.add(i[n])},sortStyles:function(e){for(var t=["border","border-bottom","font-size","background"],n=r.parseCssText(e.attributes.style),o=r.object.keys(n),s=[],i=[],l=0;l<o.length;l++)-1!==r.indexOf(t,o[l].toLowerCase())?s.push(o[l]):i.push(o[l]);for(s.sort((function(e,n){return r.indexOf(t,e.toLowerCase())-r.indexOf(t,n.toLowerCase())})),o=[].concat(s,i),s={},l=0;l<o.length;l++)s[o[l]]=n[o[l]];e.attributes.style=CKEDITOR.tools.writeCssText(s)},pushStylesLower:function(e,n,o){if(!e.attributes.style||0===e.children.length)return!1;n=n||{};var s,i={"list-style-type":!0,width:!0,height:!0,border:!0,"border-":!0},l=r.parseCssText(e.attributes.style);for(s in l)if(!(s.toLowerCase()in i||i[s.toLowerCase().replace(/\-.*$/,"-")]||s.toLowerCase()in n)){for(var a=!1,u=0;u<e.children.length;u++){var c=e.children[u];if(c.type===CKEDITOR.NODE_TEXT&&o){var d=new CKEDITOR.htmlParser.element("span");d.setHtml(c.value),c.replaceWith(d),c=d}c.type===CKEDITOR.NODE_ELEMENT&&(a=!0,t.setStyle(c,s,l[s]))}a&&delete l[s]}return e.attributes.style=CKEDITOR.tools.writeCssText(l),!0},inliner:{filtered:"break-before break-after break-inside page-break page-break-before page-break-after page-break-inside".split(" "),parse:function(e){function r(e){var t=e.indexOf("{"),r=e.indexOf("}");return o(e.substring(t+1,r),!0)}var n,o=CKEDITOR.tools.parseCssText,s=t.inliner.filter,i=e.is?e.$.sheet:function(e){var t=new CKEDITOR.dom.element("style"),r=new CKEDITOR.dom.element("iframe");return r.hide(),CKEDITOR.document.getBody().append(r),r.$.contentDocument.documentElement.appendChild(t.$),t.$.textContent=e,r.remove(),t.$.sheet}(e);if(e=[],i)for(i=i.cssRules,n=0;n<i.length;n++)i[n].type===window.CSSRule.STYLE_RULE&&e.push({selector:i[n].selectorText,styles:s(r(i[n].cssText))});return e},filter:function(e){var n,o=t.inliner.filtered,s=r.array.indexOf,i={};for(n in e)-1===s(o,n)&&(i[n]=e[n]);return i},sort:function(e){return e.sort(function(e){var t=CKEDITOR.tools.array.map(e,(function(e){return e.selector}));return function(e,r){var n=-1!==(""+e.selector).indexOf(".")?1:0;return 0!==(n=(-1!==(""+r.selector).indexOf(".")?1:0)-n)?n:t.indexOf(r.selector)-t.indexOf(e.selector)}}(e))},inline:function(r){var n=t.inliner.parse,o=t.inliner.sort,s=function(e){return e=(new DOMParser).parseFromString(e,"text/html"),new CKEDITOR.dom.document(e)}(r);return o=o(function(e){var t,r=[];for(t=0;t<e.count();t++)r=r.concat(n(e.getItem(t)));return r}(r=s.find("style"))),CKEDITOR.tools.array.forEach(o,(function(t){var r,n,o,i=t.styles;for(t=s.find(t.selector),e(i),o=0;o<t.count();o++)r=t.getItem(o),e(n=CKEDITOR.tools.parseCssText(r.getAttribute("style"))),n=CKEDITOR.tools.extend({},n,i),r.setAttribute("style",CKEDITOR.tools.writeCssText(n))})),s}}},t=n.styles,n.lists={getElementIndentation:function(e){if((e=r.parseCssText(e.attributes.style)).margin||e.MARGIN){e.margin=e.margin||e.MARGIN;var t={styles:{margin:e.margin}};CKEDITOR.filter.transformationsTools.splitMarginShorthand(t),e["margin-left"]=t.styles["margin-left"]}return parseInt(r.convertToPx(e["margin-left"]||"0px"),10)}},n.elements={replaceWithChildren:function(e){for(var t=e.children.length-1;0<=t;t--)e.children[t].insertAfter(e)}},n.createAttributeStack=function(e,t){var r,n=[];for(e.filterChildren(t),r=e.children.length-1;0<=r;r--)n.unshift(e.children[r]),e.children[r].remove();r=e.attributes;var o,s=e,i=!0;for(o in r)if(i)i=!1;else{var l=new CKEDITOR.htmlParser.element(e.name);l.attributes[o]=r[o],s.add(l),s=l,delete r[o]}for(r=0;r<n.length;r++)s.add(n[r])},n.parseShorthandMargins=e}();
